<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Student Management - SCS6027 Console</title>
  <link rel="stylesheet" href="https://saphahcentral.github.io/saphah/style-internal.css">
  <script src="include.js" defer></script>
  <script type="module" defer>
    import { addStudent, listStudents } from './students.js';

    document.addEventListener('DOMContentLoaded', async () => {
      const form = document.getElementById('student-form');
      const listEl = document.getElementById('student-list');

      // Function to refresh student list
      function renderList() {
        const students = listStudents();
        listEl.innerHTML = '';
        if (students.length === 0) {
          listEl.innerHTML = '<li>No students registered yet.</li>';
        } else {
          students.forEach(s => {
            const li = document.createElement('li');
            li.textContent = `${s.id}. ${s.name} (${s.email})`;
            listEl.appendChild(li);
          });
        }
      }

      // Initial render
      renderList();

      // Form submit handler
      form.addEventListener('submit', e => {
        e.preventDefault();
        const name = document.getElementById('student-name').value.trim();
        const email = document.getElementById('student-email').value.trim();
        if (!name || !email) return alert('Both name and email are required.');
        try {
          addStudent(name, email);
          renderList();
          form.reset();
        } catch (err) {
          console.error(err);
          alert('Error adding student: ' + err.message);
        }
      });
    });
  </script>
</head>
<body>
  <div data-include="header.html"></div>
  <div data-include="nav.html"></div>

  <main>
    <h1>Student Management</h1>
    <form id="student-form">
      <label>Name: <input type="text" id="student-name" required></label><br>
      <label>Email: <input type="email" id="student-email" required></label><br>
      <button type="submit">Add Student</button>
    </form>

    <h2>Registered Students</h2>
    <ul id="student-list"></ul>
  </main>

  <div data-include="footer.html"></div>
</body>
</html>
